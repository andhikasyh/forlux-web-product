---
import ProductCard from './ProductCard';
import { currentLanguage } from '../stores/languageStore';

// Keep your translations object
const translations = {
  en: {
    madeIn: "100% Made in Indonesia",
    sectionTitle: "Complete Traffic Management Suite",
    sectionDescription: "Discover our comprehensive range of smart traffic solutions, engineered and manufactured in Indonesia to meet global standards.",
    products: [
      {
        id: 'integra',
        name: 'FORLUX Integra',
        tagline: 'Next-Gen Traffic Control',
        description: 'Revolutionary smart traffic control system powered by ARM Cortex M4 technology, delivering unmatched reliability and real-time control.',
        features: [
          {
            icon: 'üîß',
            title: 'ARM Cortex M4',
            desc: 'Industrial-grade T7 series processor'
          },
          {
            icon: 'üîÑ',
            title: 'Hot-Swappable Design',
            desc: 'Zero-downtime maintenance'
          },
          {
            icon: 'üì°',
            title: 'Fiber Network',
            desc: 'High-speed data transmission'
          },
          {
            icon: '‚ö°',
            title: 'Real-time Control',
            desc: 'Instant traffic optimization'
          }
        ],
        specs: [
          'Advanced thermal management',
          'Redundant power supply',
          'Industrial-grade components',
          'Remote diagnostics'
        ],
        animationType: 'processor',
        gradient: 'from-forlux-orange-primary to-forlux-orange-secondary',
        badge: 'Coming Soon'
      },
      {
        id: 'luminox',
        name: 'FORLUX Luminox',
        tagline: 'Intelligent Traffic Lights',
        description: 'Next-generation traffic light control system designed specifically for Indonesias unique traffic patterns.',
        features: [
          {
            icon: 'üéØ',
            title: 'Adaptive Control',
            desc: 'Real-time traffic response'
          },
          {
            icon: 'üö®',
            title: 'Emergency Priority',
            desc: 'Automatic route clearing'
          },
          {
            icon: '‚òî',
            title: 'Weather Adaptive',
            desc: 'Environmental optimization'
          },
          {
            icon: 'üí°',
            title: 'Smart LED',
            desc: 'Energy-efficient lighting'
          }
        ],
        specs: [
          'Multi-phase signal control',
          'Fail-safe operation',
          'Energy monitoring',
          'Predictive maintenance'
        ],
        animationType: 'trafficLight',
        gradient: 'from-forlux-green-primary to-forlux-green-secondary',
        badge: 'Pre-order'
      },
      {
        id: 'SmartView',
        name: 'FORLUX SmartView',
        tagline: 'AI-Powered Surveillance',
        description: 'Advanced AI-powered traffic cameras that transform raw footage into actionable insights.',
        features: [
          {
            icon: 'üöó',
            title: 'Vehicle Detection',
            desc: 'Real-time recognition'
          },
          {
            icon: 'üîç',
            title: 'Plate Recognition',
            desc: 'High-accuracy ANPR'
          },
          {
            icon: 'üìä',
            title: 'Flow Analysis',
            desc: 'Traffic pattern insights'
          },
          {
            icon: '‚ö†Ô∏è',
            title: 'Incident Detection',
            desc: 'Automatic alerts'
          }
        ],
        specs: [
          '4K resolution capture',
          'Night vision capability',
          'Edge AI processing',
          'Weather-resistant IP67'
        ],
        animationType: 'camera',
        gradient: 'from-forlux-orange-secondary to-forlux-orange-accent',
        badge: 'Featured'
      },
      {
        id: 'samson',
        name: 'FORLUX-SAMSON',
        tagline: 'Command & Control',
        description: 'Comprehensive traffic monitoring system that unifies all FORLUX components into a single GIS-based command center.',
        features: [
          {
            icon: 'üåç',
            title: 'GIS Integration',
            desc: 'Real-time mapping'
          },
          {
            icon: 'üì±',
            title: 'Multi-platform',
            desc: 'Access anywhere'
          },
          {
            icon: 'ü§ñ',
            title: 'AI Analytics',
            desc: 'Smart predictions'
          },
          {
            icon: 'üìä',
            title: 'Custom Reports',
            desc: 'Detailed insights'
          }
        ],
        specs: [
          'Cloud-native architecture',
          'Real-time synchronization',
          'Multi-tenant support',
          'Advanced encryption'
        ],
        animationType: 'dashboard',
        gradient: 'from-forlux-green-secondary to-forlux-green-accent',
        badge: 'Enterprise'
      }
    ]
  },
  id: {
    madeIn: "100% Buatan Indonesia",
    sectionTitle: "Rangkaian Lengkap Manajemen Lalu Lintas",
    sectionDescription: "Temukan rangkaian solusi lalu lintas pintar kami, direkayasa dan diproduksi di Indonesia dengan standar global.",
    products: [
      {
        id: 'integra',
        name: 'FORLUX Integra',
        tagline: 'Kontrol Lalu Lintas Generasi Baru',
        description: 'Sistem kontrol lalu lintas revolusioner yang didukung teknologi ARM Cortex M4, memberikan keandalan dan kontrol real-time yang tak tertandingi.',
        features: [
          {
            icon: 'üîß',
            title: 'ARM Cortex M4',
            desc: 'Prosesor seri T7 kelas industri'
          },
          {
            icon: 'üîÑ',
            title: 'Desain Hot-Swappable',
            desc: 'Pemeliharaan tanpa downtime'
          },
          {
            icon: 'üì°',
            title: 'Jaringan Fiber',
            desc: 'Transmisi data kecepatan tinggi'
          },
          {
            icon: '‚ö°',
            title: 'Kontrol Real-time',
            desc: 'Optimasi lalu lintas instan'
          }
        ],
        specs: [
          'Manajemen termal canggih',
          'Catu daya redundan',
          'Komponen kelas industri',
          'Diagnostik jarak jauh'
        ],
        animationType: 'processor',
        gradient: 'from-forlux-orange-primary to-forlux-orange-secondary',
        badge: 'Coming Soon'
      },
      {
        id: 'luminox',
        name: 'FORLUX Luminox',
        tagline: 'Lampu Lalu Lintas Cerdas',
        description: 'Sistem kontrol lampu lalu lintas generasi baru yang dirancang khusus untuk pola lalu lintas unik Indonesia.',
        features: [
          {
            icon: 'üéØ',
            title: 'Kontrol Adaptif',
            desc: 'Respons lalu lintas real-time'
          },
          {
            icon: 'üö®',
            title: 'Prioritas Darurat',
            desc: 'Pembukaan jalur otomatis'
          },
          {
            icon: '‚òî',
            title: 'Adaptif Cuaca',
            desc: 'Optimasi lingkungan'
          },
          {
            icon: 'üí°',
            title: 'LED Pintar',
            desc: 'Pencahayaan hemat energi'
          }
        ],
        specs: [
          'Kontrol multi-fase',
          'Operasi gagal-aman',
          'Pengawasan energi',
          'Pemeliharaan prediktif'
        ],
        animationType: 'trafficLight',
        gradient: 'from-forlux-green-primary to-forlux-green-secondary',
        badge: 'Pre-order'
      },
      {
        id: 'SmartView',
        name: 'FORLUX SmartView',
        tagline: 'Pengawasan AI-Powered',
        description: 'Kamera lalu lintas AI-powered yang mengubah video mentah menjadi wawasan yang dapat diambil tindakan.',
        features: [
          {
            icon: 'üöó',
            title: 'Deteksi Kendaraan',
            desc: 'Pengenalan real-time'
          },
          {
            icon: 'üîç',
            title: 'Pengenalan Plat',
            desc: 'ANPR dengan keakuratan tinggi'
          },
          {
            icon: 'üìä',
            title: 'Analisa Aliran',
            desc: 'Wawasan pola lalu lintas'
          },
          {
            icon: '‚ö†Ô∏è',
            title: 'Deteksi Insiden',
            desc: 'Pemberitahuan otomatis'
          }
        ],
        specs: [
          'Pengambilan resolusi 4K',
          'Kemampuan penglihatan pada malam hari',
          'Pemrosesan AI tepi',
          'IP67 tahan cuaca'
        ],
        animationType: 'camera',
        gradient: 'from-forlux-orange-secondary to-forlux-orange-accent',
        badge: 'Featured'
      },
      {
        id: 'samson',
        name: 'FORLUX-SAMSON',
        tagline: 'Perintah & Kontrol',
        description: 'Sistem pengawasan lalu lintas yang mengintegrasikan semua komponen FORLUX menjadi pusat perintah GIS tunggal.',
        features: [
          {
            icon: 'üåç',
            title: 'Integrasi GIS',
            desc: 'Pemetaan real-time'
          },
          {
            icon: 'üì±',
            title: 'Multi-platform',
            desc: 'Akses dimana-mana'
          },
          {
            icon: 'ü§ñ',
            title: 'Analisa AI',
            desc: 'Prediksi cerdas'
          },
          {
            icon: 'üìä',
            title: 'Laporan Kustom',
            desc: 'Wawasan mendetail'
          }
        ],
        specs: [
          'Arsitektur cloud-native',
          'Sinkronisasi real-time',
          'Dukungan multi-tenant',
          'Enkripsi yang canggih'
        ],
        animationType: 'dashboard',
        gradient: 'from-forlux-green-secondary to-forlux-green-accent',
        badge: 'Enterprise'
      }
    ]
  }
};

// Get initial language (will be used for SSR)
const initialLanguage = 'en';
---

<section class="relative py-32">
  <div class="absolute inset-0">
    <div class="absolute inset-0 bg-gradient-radial from-forlux-orange-primary/10 to-transparent opacity-30 blur-3xl"></div>
  </div>
  
  <div 
    class="container mx-auto px-4 relative z-10"
    id="products-container"
    data-translations={JSON.stringify(translations)}
  >    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-6xl mx-auto" id="products-grid">
      {translations[initialLanguage].products.map((product, index) => (
        <div 
          data-aos="fade-up" 
          data-aos-delay={index * 100}
          class="flex items-stretch"
        >
          <ProductCard 
            product={product} 
            translations={translations} 
            client:load 
          />
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  import { currentLanguage } from '../stores/languageStore';

  function updateContent() {
    const container = document.getElementById('products-container');
    if (!container) return;

    const translations = JSON.parse(container.dataset.translations || '{}');
    const lang = currentLanguage.get();
    const content = translations[lang];

    if (!content) return;

    // Update text content
    document.querySelectorAll('[data-translate]').forEach((element) => {
      const el = element as HTMLElement;
      const key = el.dataset.translate;
      if (key && content[key]) {
        el.textContent = content[key];
      }
    });

    // Update product cards
    const productCards = document.querySelectorAll('product-card');
    productCards.forEach((card, index) => {
      const product = content.products[index];
      if (product) {
        card.setAttribute('data-product', JSON.stringify(product));
        card.setAttribute('data-language', lang);
      }
    });
  }

  // Listen for language changes
  currentLanguage.subscribe(() => {
    requestAnimationFrame(updateContent);
  });

  // Initial update when the page loads
  document.addEventListener('DOMContentLoaded', () => {
    requestAnimationFrame(updateContent);
  });
</script>

<style>
  [data-translate] {
    transition: opacity 0.3s ease;
  }

  [data-translate].updating {
    opacity: 0.5;
  }
</style>