---
import { currentLanguage } from '../stores/languageStore';

// Initial language value for SSR with fallback
const initialLang = currentLanguage.get() || 'en';

// Hardcoded translations
const translations = {
  en: {
    hero: {
      badge: "International Quality, Indonesian Pride",
      title1: "Revolutionizing",
      title2: "Traffic Management",
      description: "FORLUX, Indonesia's first AI-powered traffic system."
    },
    products: {
      items: {
        panel: {
          title: "FORLUX Control Panel",
          description: "Revolutionary smart traffic control system powered by ARM Cortex M4 technology, delivering unmatched reliability and real-time control."
        },
        luminox: {
          title: "FORLUX LuminoX",
          description: "High-performance traffic light system with advanced Fresnel Lens technology for optimal visibility and energy efficiency."
        },
        SmartView: {
          title: "FORLUX SmartView",
          description: "Advanced AI-powered traffic monitoring system that transforms raw footage into actionable insights."
        }
      }
    }
  },
  id: {
    hero: {
      badge: "Kualitas Internasional, Kebanggaan Indonesia",
      title1: "Revolusi",
      title2: "Manajemen Lalu Lintas",
      description: "FORLUX, sistem lalu lintas berbasis AI pertama di Indonesia."
    },
    products: {
      items: {
        panel: {
          title: "Panel Kontrol FORLUX",
          description: "Sistem kontrol lalu lintas pintar revolusioner yang didukung teknologi ARM Cortex M4, memberikan keandalan dan kontrol real-time yang tak tertandingi."
        },
        luminox: {
          title: "FORLUX LuminoX",
          description: "Sistem lampu lalu lintas berkinerja tinggi dengan teknologi Fresnel Lens canggih untuk visibilitas dan efisiensi energi optimal."
        },
        SmartView: {
          title: "FORLUX SmartView",
          description: "Sistem pemantauan lalu lintas bertenaga AI canggih yang mengubah rekaman mentah menjadi wawasan yang dapat ditindaklanjuti."
        }
      }
    }
  }
};

const heroContent = translations[initialLang].hero;
---

<section class="relative min-h-[40vh] flex items-center justify-center py-32 overflow-hidden" id="product-hero">
  <!-- Background Effects -->
  <div class="absolute inset-0">
    <div class="absolute inset-0 bg-gradient-radial from-forlux-orange-primary/20 to-transparent opacity-30 blur-3xl"></div>
  </div>

  <!-- Main Content -->
  <div class="container relative z-10 px-4 mx-auto">
    <div class="text-center max-w-4xl mx-auto">
      <div class="mb-6" data-aos="fade-down">
        <span 
          class="inline-block px-4 py-2 text-sm font-medium text-forlux-orange-primary bg-forlux-orange-primary/10 rounded-full border border-forlux-orange-primary/20"
          id="hero-label"
        >
          {heroContent.badge}
        </span>
      </div>

      <h1 
        class="text-4xl md:text-5xl lg:text-6xl font-bold mb-6 text-white"
        data-aos="fade-up"
        data-aos-delay="100"
      >
        <span 
          class="bg-clip-text text-transparent bg-forlux-orange-gradient"
          id="hero-title-1"
        >
          {heroContent.title1}
        </span>
        <br />
        <span id="hero-title-2">{heroContent.title2}</span>
      </h1>

      <p 
        class="text-lg text-gray-400 mb-8 max-w-2xl mx-auto leading-relaxed"
        data-aos="fade-up"
        data-aos-delay="200"
        id="hero-description"
      >
        {heroContent.description}
      </p>
    </div>
  </div>
</section>

<!-- Replace the Product Showcase section -->
<div class="container mx-auto px-4 py-24 relative z-10">
  <!-- Product Grid with Alternating Layout -->
  <div class="space-y-32">
    <!-- Product 1 -->
    <div 
      class="group relative flex flex-col md:flex-row items-center gap-12"
      data-aos="fade-right"
    >
      <!-- Image Section -->
      <div class="w-full md:w-1/2 relative">
        <div class="absolute -inset-4 bg-gradient-to-r from-forlux-orange-primary/20 to-transparent rounded-3xl blur-2xl opacity-0 group-hover:opacity-100 transition-all duration-700"></div>
        <img 
          src="/forlux-panel-1.png" 
          alt="Forlux Control Panel" 
          class="w-full h-auto transform group-hover:scale-105 transition-all duration-700 relative z-10"
        />
      </div>

      <!-- Content Section -->
      <div class="w-full md:w-1/2 space-y-6 text-left">
        <h3 class="text-3xl font-bold">
          <span class="bg-clip-text text-transparent bg-gradient-to-r from-forlux-orange-primary to-forlux-orange-secondary">
            {translations[initialLang].products.items.panel.title}
          </span>
        </h3>
        <p class="text-gray-400 text-lg leading-relaxed">
          {translations[initialLang].products.items.panel.description}
        </p>
        <div class="flex gap-4 pt-4">
          <span class="px-4 py-2 rounded-full bg-forlux-orange-primary/10 text-forlux-orange-primary text-sm">
            Advanced Control
          </span>
          <span class="px-4 py-2 rounded-full bg-forlux-orange-primary/10 text-forlux-orange-primary text-sm">
            Modular Design
          </span>
        </div>
      </div>
    </div>

    <!-- Product 2 -->
    <div 
      class="group relative flex flex-col-reverse md:flex-row-reverse items-center gap-12"
      data-aos="fade-left"
    >
      <!-- Image Section with Size Constraints -->
      <div class="w-full md:w-1/2 relative flex justify-center">
        <div class="absolute -inset-4 bg-gradient-to-l from-forlux-green-primary/20 to-transparent rounded-3xl blur-2xl opacity-0 group-hover:opacity-100 transition-all duration-700"></div>
        <img 
          src="/luminox.png" 
          alt="Luminox System" 
          class="w-auto h-auto max-w-[80%] md:max-w-[70%] transform group-hover:scale-105 transition-all duration-700 relative z-10"
        />
      </div>

      <!-- Content Section -->
      <div class="w-full md:w-1/2 space-y-6 text-left">
        <h3 class="text-3xl font-bold">
          <span class="bg-clip-text text-transparent bg-gradient-to-r from-forlux-green-primary to-forlux-green-secondary">
            {translations[initialLang].products.items.luminox.title}
          </span>
        </h3>
        <p class="text-gray-400 text-lg leading-relaxed">
          {translations[initialLang].products.items.luminox.description}
        </p>
        <div class="flex gap-4 pt-4">
          <span class="px-4 py-2 rounded-full bg-forlux-green-primary/10 text-forlux-green-primary text-sm">
            Energy Efficient
          </span>
          <span class="px-4 py-2 rounded-full bg-forlux-green-primary/10 text-forlux-green-primary text-sm">
            Smart Control
          </span>
        </div>
      </div>
    </div>

    <!-- Product 3 -->
    <div 
      class="group relative flex flex-col md:flex-row items-center gap-12"
      data-aos="fade-right"
    >
      <!-- Image Section with Adjusted Size -->
      <div class="w-full md:w-1/2 relative flex justify-center">
        <div class="absolute -inset-4 bg-gradient-to-r from-forlux-orange-secondary/20 to-transparent rounded-3xl blur-2xl opacity-0 group-hover:opacity-100 transition-all duration-700"></div>
        <img 
          src="/SmartView.png" 
          alt="SmartView Interface" 
          class="w-auto h-auto max-w-[85%] md:max-w-[75%] transform group-hover:scale-105 transition-all duration-700 relative z-10"
        />
      </div>

      <!-- Content Section -->
      <div class="w-full md:w-1/2 space-y-6 text-left">
        <h3 class="text-3xl font-bold">
          <span class="bg-clip-text text-transparent bg-gradient-to-r from-forlux-orange-secondary to-forlux-orange-accent">
            {translations[initialLang].products.items.SmartView.title}
          </span>
        </h3>
        <p class="text-gray-400 text-lg leading-relaxed">
          {translations[initialLang].products.items.SmartView.description}
        </p>
        <div class="flex gap-4 pt-4">
          <span class="px-4 py-2 rounded-full bg-forlux-orange-secondary/10 text-forlux-orange-secondary text-sm">
            Real-time Analytics
          </span>
          <span class="px-4 py-2 rounded-full bg-forlux-orange-secondary/10 text-forlux-orange-secondary text-sm">
            Intuitive UI
          </span>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .traffic-grid {
    background-image: linear-gradient(90deg, rgba(255,255,255,.1) 1px, transparent 1px),
                      linear-gradient(rgba(255,255,255,.1) 1px, transparent 1px);
    background-size: 50px 50px;
  }

  .data-point {
    @apply absolute w-2 h-2 rounded-full bg-forlux-orange-primary/60;
    filter: blur(1px);
  }

  .connection-path {
    fill: none;
    stroke: rgba(255, 255, 255, 0.2);
    stroke-width: 1;
  }

  .mix-blend-lighten {
    mix-blend-mode: lighten;
  }
</style>

<script>
  import { currentLanguage } from '../stores/languageStore';
  import { translations } from '../utils/translations';
  import gsap from 'gsap';

  function initAnimations() {
    // Check if device is mobile
    const isMobile = window.innerWidth < 768;
    
    // Reduce number of data points for mobile
    const dataPointCount = isMobile ? 4 : 10;
    const dataPoints = document.querySelectorAll('.data-point') as NodeListOf<HTMLElement>;
    
    // Hide excess data points on mobile
    dataPoints.forEach((point, index) => {
      if (index >= dataPointCount) {
        point.style.display = 'none';
        return;
      }

      // Simplified animation for mobile
      gsap.set(point, {
        x: gsap.utils.random(0, window.innerWidth),
        y: gsap.utils.random(0, window.innerHeight),
      });

      // Reduced animation complexity for mobile
      gsap.to(point, {
        duration: isMobile ? 4 : gsap.utils.random(3, 6),
        x: `+=${isMobile ? gsap.utils.random(-150, 150) : gsap.utils.random(-300, 300)}`,
        y: `+=${isMobile ? gsap.utils.random(-150, 150) : gsap.utils.random(-300, 300)}`,
        opacity: isMobile ? 0.3 : gsap.utils.random(0.2, 0.6),
        scale: isMobile ? 1 : gsap.utils.random(0.8, 1.5),
        repeat: -1,
        yoyo: true,
        ease: "none",
        delay: index * (isMobile ? 0.4 : 0.2)
      });
    });

    // Simplified grid animation for mobile
    if (isMobile) {
      gsap.to('.traffic-grid', {
        backgroundPosition: '25px 25px',
        duration: 30,
        repeat: -1,
        ease: "none"
      });
    } else {
      gsap.to('.traffic-grid', {
        backgroundPosition: '50px 50px',
        duration: 20,
        repeat: -1,
        ease: "none"
      });
    }

    // Optimize connection lines for mobile
    const connectionPath = document.querySelector('.connection-path');
    if (connectionPath) {
      // Fewer points for mobile
      const pointCount = isMobile ? 3 : 5;
      const points = [];
      
      for (let i = 0; i < pointCount; i++) {
        points.push({
          x: gsap.utils.random(0, window.innerWidth),
          y: gsap.utils.random(0, window.innerHeight)
        });
      }

      const pathString = points.reduce((acc, point, i) => (
        `${acc}${i === 0 ? 'M' : 'L'}${point.x},${point.y}`
      ), '');

      gsap.set(connectionPath, { attr: { d: pathString + 'Z' } });
      
      // Slower animation for mobile
      gsap.to(connectionPath, {
        strokeDashoffset: isMobile ? 500 : 1000,
        strokeDasharray: isMobile ? 500 : 1000,
        duration: isMobile ? 15 : 10,
        repeat: -1,
        ease: "none"
      });
    }

    // Optimize content animations
    const tl = gsap.timeline({ 
      defaults: { 
        ease: "power3.out",
        duration: isMobile ? 0.6 : 0.8 
      }
    });

    tl.from('#hero-label', {
      y: 20,
      opacity: 0,
    })
    .from('#hero-title-1, #hero-title-2', {
      y: 30,
      opacity: 0,
      stagger: 0.15,
    }, "-=0.3")
    .from('#hero-description', {
      y: 20,
      opacity: 0,
    }, "-=0.3");
  }

  function updateContent(lang) {
    const t = translations[lang].products.hero;
    requestAnimationFrame(() => {
      document.getElementById('hero-label').textContent = t.label;
      document.getElementById('hero-title-1').textContent = t.title1;
      document.getElementById('hero-title-2').textContent = t.title2;
      document.getElementById('hero-description').textContent = t.description;
    });
  }

  function initProductHero() {
    // Initial content update
    updateContent(currentLanguage.get());

    // Delay animations slightly to ensure smooth page load
    setTimeout(() => {
      initAnimations();
    }, 100);

    const unsubscribe = currentLanguage.subscribe(newLang => {
      updateContent(newLang);
    });

    return () => {
      gsap.killTweensOf('.data-point');
      gsap.killTweensOf('.traffic-grid');
      gsap.killTweensOf('.connection-path');
      unsubscribe();
    };
  }

  // Handle initial load and page transitions with debouncing
  let initTimeout: number;
  document.addEventListener('astro:page-load', () => {
    clearTimeout(initTimeout);
    initTimeout = setTimeout(() => {
      const cleanup = initProductHero();
      
      document.addEventListener('astro:before-preparation', () => {
        cleanup();
      }, { once: true });
    }, 100);
  });
</script>

<style>
  /* Optimize grid for mobile */
  .traffic-grid {
    background-image: linear-gradient(90deg, rgba(255,255,255,.05) 1px, transparent 1px),
                      linear-gradient(rgba(255,255,255,.05) 1px, transparent 1px);
    background-size: 25px 25px;
  }

  @media (min-width: 768px) {
    .traffic-grid {
      background-size: 50px 50px;
      background-image: linear-gradient(90deg, rgba(255,255,255,.1) 1px, transparent 1px),
                        linear-gradient(rgba(255,255,255,.1) 1px, transparent 1px);
    }
  }

  .data-point {
    @apply absolute w-1.5 h-1.5 md:w-2 md:h-2 rounded-full bg-forlux-orange-primary/40 md:bg-forlux-orange-primary/60;
    filter: blur(0.5px);
  }

  @media (min-width: 768px) {
    .data-point {
      filter: blur(1px);
    }
  }

  .connection-path {
    fill: none;
    stroke: rgba(255, 255, 255, 0.1);
    stroke-width: 0.5;
  }

  @media (min-width: 768px) {
    .connection-path {
      stroke: rgba(255, 255, 255, 0.2);
      stroke-width: 1;
    }
  }
</style>
</style>